#!/usr/bin/env python
import tkinter as tk
import tkinter.ttk as ttk
import os
import subprocess

top = tk.Tk()
home = os.path.expanduser('~')
os.environ['SDL_VIDEO_CENTERED'] = '1'

themes = subprocess.check_output(['mondo', '-l', 'themes'])
themes_list = themes.split(b'\n')
for i in range(0,len(themes_list)):
    themes_list[i] = themes_list[i].decode("utf-8")
Topbar = tk.IntVar()
Bartype = tk.IntVar()
Gapps = tk.IntVar()
Theme = tk.StringVar()
def update(lol = Gapps.get()):
    with open(home+'/.config/settings/main.conf','r') as infile:
        with open(home+'/.config/mondo/generator/dwm/_mondo-template', "w") as outfile:
            for line in infile:
                new_line = line.replace("__barpos__", str(Topbar.get()))
                new_line = new_line.replace("__bar__", str(Bartype.get()))
                if lol not in themes_list:
                    new_line = new_line.replace("__gapps__", str(lol))
                else:
                    new_line = new_line.replace("__gapps__", str(Gapps.get()))
                print(new_line[0:-1])
                outfile.write(new_line)
    with open(home+'/.config/settings/current.conf','w') as outfile:
        outfile.write(str(Topbar.get())+'\n')
        outfile.write(str(Bartype.get())+'\n')
        outfile.write(str(Gapps.get())+'\n')
        outfile.write(Theme.get()+'\n')
with open(home+'/.config/settings/current.conf','r') as infile:
    Topbar.set(int(infile.readline()))
    Bartype.set(int(infile.readline()))
    Gapps.set(int(infile.readline()))
    Theme.set(infile.readline()[0:-1])

tabs = ttk.Notebook(top)

page1 = ttk.Frame(tabs)
tabs.add(page1, text='visual')
tabs.pack()

Frame_Topbar = tk.Frame(page1)
Topbar_c = tk.Checkbutton(Frame_Topbar, text = "Top Bar", variable = Topbar, \
                          onvalue = 1, offvalue = 0, command = update)

Frame_Bartype = tk.Frame(page1)
BarType0_r = tk.Radiobutton(Frame_Bartype, text="Selected window", variable=Bartype, value=0,
                            command=update)
BarType1_r = tk.Radiobutton(Frame_Bartype, text="All windows", variable=Bartype, value=1,
                            command=update)
label_gapps = tk.Label(page1, text = 'gapps')
Gapps_s = tk.Scale(page1, variable = Gapps, from_ = 0, to = 40, \
                   command = update )
theme_m = tk.OptionMenu(page1, Theme, *themes_list, command = update)

Frame_Topbar.pack()
Topbar_c.pack(side = tk.LEFT)

Frame_Bartype.pack()
BarType0_r.pack(side = tk.LEFT)
BarType1_r.pack(side = tk.LEFT)
label_gapps.pack(anchor=tk.W)
Gapps_s.pack(anchor=tk.W)
theme_m.pack()

page2 = ttk.Frame(tabs)
tabs.add(page2, text='commands')

top.mainloop()

subprocess.call(["mondo", "-fg", "all"])
#subprocess.call(["mondo", "-a", Theme.get()])
print("updated mondo")
